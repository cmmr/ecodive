# ecodive

`ecodive` is an R package for calculating ecological diversity metrics
in a parallelized and memory-efficient manner. It is designed to handle
large datasets, such as those common in microbiome research.

## Why ecodive?

Analyzing ecological diversity is often a computational bottleneck,
especially with large datasets. `ecodive` addresses this by providing:

- **High Performance:** `ecodive` is written in C and parallelized using
  pthreads, making it dramatically faster than other R packages.
  [Benchmarks](https://cmmr.github.io/ecodive/articles/benchmark.html)
  show it can be up to **9,000x faster** and use up to **200,000x less
  memory**.

- **Zero Dependencies:** The package has no external R dependencies,
  making it lightweight, stable, and easy to install. This also makes it
  an ideal and secure backend for other R packages.

- **Comprehensive Metrics:** It implements a wide range of common alpha
  and beta diversity metrics, including classic and phylogenetic-aware
  methods like **Faith’s PD** and the **complete UniFrac family**.

- **Ease of Use:** The API is simple and integrates seamlessly with
  popular bioinformatics packages like
  [`phyloseq`](http://joey711.github.io/phyloseq/) and
  [`rbiom`](https://cmmr.github.io/rbiom/).

## Installation

The latest stable version can be installed from CRAN.

``` r
install.packages('ecodive')
```

The development version is available on GitHub.

``` r
install.packages('pak')
pak::pak('cmmr/ecodive')
```

## Usage

`ecodive` functions are straightforward to use. Here are a few examples.

### With `phyloseq` or `rbiom` objects

The easiest way to use `ecodive` is with a `phyloseq`, `rbiom`, or
`TreeSummarizedExperiment` object. These objects conveniently bundle the
count data and phylogenetic tree.

``` r
library(ecodive)
data(esophagus, package = 'phyloseq')
data(hmp50,     package = 'rbiom')

# Calculate weighted UniFrac distance
w_unifrac <- weighted_unifrac(esophagus)
print(w_unifrac)
#>           B         C
#> C 0.1050480          
#> D 0.1401124 0.1422409

# Calculate Faith's Phylogenetic Diversity
faith_pd <- faith(hmp50)
print(faith_pd[1:4])
#>   HMP01   HMP02   HMP03   HMP04 
#> 6.22296 8.59432 8.93375 9.86597 
```

### With basic R objects

You can also provide the count data and phylogenetic tree as separate
objects.

The `ex_counts` and `ex_tree` objects are included with `ecodive`.

``` r
## Example Data ----------------------
counts <- rarefy(ex_counts)
counts[,1:4]
#>        Streptococcus Bacteroides Corynebacterium Haemophilus
#> Saliva           162           2               0         180
#> Gums             309           2               0          34
#> Nose               6           0             171           0
#> Stool              1         341               1           1


## Alpha Diversity -------------------
shannon(counts)
#>     Saliva       Gums       Nose      Stool 
#> 0.74119910 0.35692121 1.10615349 0.07927797 

faith(counts, tree = ex_tree)
#> Saliva   Gums   Nose  Stool 
#>    180    155    101    202 


## Beta Diversity --------------------
bray(counts)
#>          Saliva      Gums      Nose
#> Gums  0.4260870                    
#> Nose  0.9797101 0.9826087          
#> Stool 0.9884058 0.9884058 0.9913043

weighted_unifrac(counts, tree = ex_tree)
#>          Saliva      Gums      Nose
#> Gums   36.97681                    
#> Nose   67.23768  55.97101          
#> Stool 109.77971 109.44058 110.00870
```

## Available Methods

Use
[`list_metrics()`](https://cmmr.github.io/ecodive/reference/metrics.md)
to browse the metrics available for calculating diversity.

``` r
# Alpha Diversity
list_metrics('alpha', 'id')
#>  [1] "ace"         "berger"      "brillouin"   "chao1"       "faith"      
#>  [6] "fisher"      "simpson"     "inv_simpson" "margalef"    "mcintosh"   
#> [11] "menhinick"   "observed"    "shannon"     "squares"    

# Beta Diversity
list_metrics('beta', 'id')
#>  [1] "aitchison"                 "bhattacharyya"             "bray"                     
#>  [4] "canberra"                  "chebyshev"                 "chord"                    
#>  [7] "clark"                     "sorensen"                  "divergence"               
#> [10] "euclidean"                 "generalized_unifrac"       "gower"                    
#> [13] "hamming"                   "hellinger"                 "horn"                     
#> [16] "jaccard"                   "jensen"                    "jsd"                      
#> [19] "lorentzian"                "manhattan"                 "matusita"                 
#> [22] "minkowski"                 "morisita"                  "motyka"                   
#> [25] "normalized_unifrac"        "ochiai"                    "psym_chisq"               
#> [28] "soergel"                   "squared_chisq"             "squared_chord"            
#> [31] "squared_euclidean"         "topsoe"                    "unweighted_unifrac"       
#> [34] "variance_adjusted_unifrac" "wave_hedges"               "weighted_unifrac"   
```

## Documentation

The online manual for ecodive is available at
<https://cmmr.github.io/ecodive/>. It includes a getting started guide,
articles on alpha/beta diversity, and reference pages for each function.

## Testing

`ecodive` has a comprehensive test suite using the `testthat` package.
All code is automatically tested via GitHub Actions upon each push to
the repository to ensure functionality and stability.

For users who have cloned the source repository, the tests can be run
locally with the following commands in an R session:

``` r
install.packages('testthat')
devtools::test()
```

## Community guidelines

### Support

Bug reports, feature requests, and general questions can be submitted at
<https://github.com/cmmr/ecodive/issues>.

### Contributing

Pull requests are welcome. Please ensure contributed code is covered by
tests and documentation (add additional tests and documentation as
needed) and passes all automated tests.

New functions must leverage C and pthreads to minimize memory and CPU
time.

Please note that the ecodive project is released with a [Contributor
Code of Conduct](https://cmmr.github.io/ecodive/CODE_OF_CONDUCT.html).
By contributing to this project, you agree to abide by its terms.

## License

`ecodive` is licensed under the [MIT
License](https://opensource.org/license/mit) © 2026 ecodive authors.

This package also contains third-party code:

- [**PCG Random Number Generation for C**](https://www.pcg-random.org):
  Licensed under the [Apache License, Version
  2.0](http://www.apache.org/licenses/LICENSE-2.0).

Detailed copyright and licensing information for all components can be
found in the
[`inst/COPYRIGHTS`](https://github.com/cmmr/ecodive/blob/main/inst/COPYRIGHTS)
file.

# Package index

## Alpha Diversity

Calculate within-sample diversity using various indices.

- [`alpha_div()`](https://cmmr.github.io/ecodive/reference/alpha_div.md)
  : Alpha Diversity Wrapper Function

### Richness metrics

Estimators focused on the number of species (richness).

- [`ace()`](https://cmmr.github.io/ecodive/reference/ace.md) :
  Abundance-based Coverage Estimator (ACE)
- [`chao1()`](https://cmmr.github.io/ecodive/reference/chao1.md) : Chao1
  Richness Estimator
- [`margalef()`](https://cmmr.github.io/ecodive/reference/margalef.md) :
  Margalef's Richness Index
- [`menhinick()`](https://cmmr.github.io/ecodive/reference/menhinick.md)
  : Menhinick's Richness Index
- [`observed()`](https://cmmr.github.io/ecodive/reference/observed.md) :
  Observed Features
- [`squares()`](https://cmmr.github.io/ecodive/reference/squares.md) :
  Squares Richness Estimator

### Diversity metrics

Indices accounting for both richness and evenness.

- [`brillouin()`](https://cmmr.github.io/ecodive/reference/brillouin.md)
  : Brillouin Index
- [`fisher()`](https://cmmr.github.io/ecodive/reference/fisher.md) :
  Fisher's Alpha
- [`inv_simpson()`](https://cmmr.github.io/ecodive/reference/inv_simpson.md)
  : Inverse Simpson Index
- [`shannon()`](https://cmmr.github.io/ecodive/reference/shannon.md) :
  Shannon Diversity Index
- [`simpson()`](https://cmmr.github.io/ecodive/reference/simpson.md) :
  Gini-Simpson Index

### Dominance metrics

Indices focused on the abundance of the most dominant species.

- [`berger()`](https://cmmr.github.io/ecodive/reference/berger.md) :
  Berger-Parker Index
- [`mcintosh()`](https://cmmr.github.io/ecodive/reference/mcintosh.md) :
  McIntosh Index

### Phylogenetic metrics

Diversity based on phylogenetic branch lengths.

- [`faith()`](https://cmmr.github.io/ecodive/reference/faith.md) :
  Faith's Phylogenetic Diversity (PD)

## Beta Diversity

Calculate between-sample similarity or distance.

- [`beta_div()`](https://cmmr.github.io/ecodive/reference/beta_div.md) :
  Beta Diversity Wrapper Function

### Abundance metrics

Distance measures using quantitative abundance data.

- [`aitchison()`](https://cmmr.github.io/ecodive/reference/aitchison.md)
  : Aitchison distance
- [`bhattacharyya()`](https://cmmr.github.io/ecodive/reference/bhattacharyya.md)
  : Bhattacharyya distance
- [`bray()`](https://cmmr.github.io/ecodive/reference/bray.md) :
  Bray-Curtis dissimilarity
- [`canberra()`](https://cmmr.github.io/ecodive/reference/canberra.md) :
  Canberra distance
- [`chebyshev()`](https://cmmr.github.io/ecodive/reference/chebyshev.md)
  : Chebyshev distance
- [`chord()`](https://cmmr.github.io/ecodive/reference/chord.md) : Chord
  distance
- [`clark()`](https://cmmr.github.io/ecodive/reference/clark.md) :
  Clark's divergence distance
- [`divergence()`](https://cmmr.github.io/ecodive/reference/divergence.md)
  : Divergence
- [`euclidean()`](https://cmmr.github.io/ecodive/reference/euclidean.md)
  : Euclidean distance
- [`gower()`](https://cmmr.github.io/ecodive/reference/gower.md) : Gower
  distance
- [`hellinger()`](https://cmmr.github.io/ecodive/reference/hellinger.md)
  : Hellinger distance
- [`horn()`](https://cmmr.github.io/ecodive/reference/horn.md) :
  Horn-Morisita dissimilarity
- [`jensen()`](https://cmmr.github.io/ecodive/reference/jensen.md) :
  Jensen-Shannon distance
- [`jsd()`](https://cmmr.github.io/ecodive/reference/jsd.md) :
  Jensen-Shannon divergence (JSD)
- [`lorentzian()`](https://cmmr.github.io/ecodive/reference/lorentzian.md)
  : Lorentzian distance
- [`manhattan()`](https://cmmr.github.io/ecodive/reference/manhattan.md)
  : Manhattan distance
- [`matusita()`](https://cmmr.github.io/ecodive/reference/matusita.md) :
  Matusita distance
- [`minkowski()`](https://cmmr.github.io/ecodive/reference/minkowski.md)
  : Minkowski distance
- [`morisita()`](https://cmmr.github.io/ecodive/reference/morisita.md) :
  Morisita dissimilarity
- [`motyka()`](https://cmmr.github.io/ecodive/reference/motyka.md) :
  Motyka dissimilarity
- [`psym_chisq()`](https://cmmr.github.io/ecodive/reference/psym_chisq.md)
  : Probabilistic Symmetric Chi-Squared distance
- [`soergel()`](https://cmmr.github.io/ecodive/reference/soergel.md) :
  Soergel distance
- [`squared_chisq()`](https://cmmr.github.io/ecodive/reference/squared_chisq.md)
  : Squared Chi-Squared distance
- [`squared_chord()`](https://cmmr.github.io/ecodive/reference/squared_chord.md)
  : Squared Chord distance
- [`squared_euclidean()`](https://cmmr.github.io/ecodive/reference/squared_euclidean.md)
  : Squared Euclidean distance
- [`topsoe()`](https://cmmr.github.io/ecodive/reference/topsoe.md) :
  Topsoe distance
- [`wave_hedges()`](https://cmmr.github.io/ecodive/reference/wave_hedges.md)
  : Wave Hedges distance

### Presence/Absence metrics

Distance measures using binary (presence/absence) data.

- [`hamming()`](https://cmmr.github.io/ecodive/reference/hamming.md) :
  Hamming distance
- [`jaccard()`](https://cmmr.github.io/ecodive/reference/jaccard.md) :
  Jaccard distance
- [`ochiai()`](https://cmmr.github.io/ecodive/reference/ochiai.md) :
  Otsuka-Ochiai dissimilarity
- [`sorensen()`](https://cmmr.github.io/ecodive/reference/sorensen.md) :
  Dice-Sorensen dissimilarity

### Phylogenetic metrics

Distance measures based on phylogenetic branch lengths (UniFrac family).

- [`unweighted_unifrac()`](https://cmmr.github.io/ecodive/reference/unweighted_unifrac.md)
  : Unweighted UniFrac
- [`weighted_unifrac()`](https://cmmr.github.io/ecodive/reference/weighted_unifrac.md)
  : Weighted UniFrac
- [`normalized_unifrac()`](https://cmmr.github.io/ecodive/reference/normalized_unifrac.md)
  : Normalized Weighted UniFrac
- [`generalized_unifrac()`](https://cmmr.github.io/ecodive/reference/generalized_unifrac.md)
  : Generalized UniFrac (GUniFrac)
- [`variance_adjusted_unifrac()`](https://cmmr.github.io/ecodive/reference/variance_adjusted_unifrac.md)
  : Variance-Adjusted Weighted UniFrac

## Utilities & Helpers

Tools for programmatic access, data manipulation, and configuration.

- [`list_metrics()`](https://cmmr.github.io/ecodive/reference/metrics.md)
  [`match_metric()`](https://cmmr.github.io/ecodive/reference/metrics.md)
  : Find and Browse Available Metrics
- [`read_tree()`](https://cmmr.github.io/ecodive/reference/read_tree.md)
  : Read a newick formatted phylogenetic tree.
- [`rarefy()`](https://cmmr.github.io/ecodive/reference/rarefy.md) :
  Rarefy Observation Counts
- [`n_cpus()`](https://cmmr.github.io/ecodive/reference/n_cpus.md) :
  Number of CPU Cores

## Datasets

Example data provided with the package.

- [`ex_counts`](https://cmmr.github.io/ecodive/reference/ex_counts.md) :
  Example counts matrix
- [`ex_tree`](https://cmmr.github.io/ecodive/reference/ex_tree.md) :
  Example phylogenetic tree

# Articles

### All vignettes

- [Alpha Diversity](https://cmmr.github.io/ecodive/articles/adiv.md):
- [Selecting a Beta Diversity
  Metric](https://cmmr.github.io/ecodive/articles/bdiv_guide.md):
- [Beta Diversity](https://cmmr.github.io/ecodive/articles/bdiv.md):
- [Benchmarks](https://cmmr.github.io/ecodive/articles/benchmark.md):
- [Introduction to
  ecodive](https://cmmr.github.io/ecodive/articles/ecodive.md):
- [Performance
  Guide](https://cmmr.github.io/ecodive/articles/performance.md):
- [UniFrac
  Calculations](https://cmmr.github.io/ecodive/articles/unifrac.md):
